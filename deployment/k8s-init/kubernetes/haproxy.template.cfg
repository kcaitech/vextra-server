global
  log 127.0.0.1 local2
  chroot /var/lib/haproxy
  pidfile /var/run/haproxy.pid
  maxconn 4096
  stats socket /var/lib/haproxy/stats.sock mode 660 level admin expose-fd listeners
  stats timeout 30s
  user haproxy
  group haproxy
  daemon

defaults
  log global
  mode http
  option httplog
  option dontlognull
  option http-server-close
  option forwardfor except 127.0.0.0/8
  option redispatch
  retries 3
  timeout http-request 10s
  timeout queue 1m
  timeout connect 10s
  timeout client 1m
  timeout server 1m
  timeout http-keep-alive 10s
  timeout check 10s
  maxconn 3000

frontend kube-apiserver
  bind *:$apiserver_port
  mode tcp
  option tcplog
  default_backend kube-apiserver

listen stats
  bind *:8888
  mode http
  stats enable
  stats uri /stats
  stats refresh 5s
  stats show-node
  stats auth kcai:kcai1212
  stats realm Haproxy\ Statistics
  log 127.0.0.1 local3 err

backend kube-apiserver
  mode tcp
  balance roundrobin
