# 获取密码、启动测试容器连接redis
REDIS_PASSWORD=$(kubectl -n bitnami-redis get secret bitnami-redis -o jsonpath="{.data.redis-password}" | base64 -d)
kubectl run -it --rm --restart='Never' \
redis-client \
--env REDIS_PASSWORD=$REDIS_PASSWORD \
--image docker.io/bitnami/redis:7.2.1-debian-11-r0 \
-- /bin/bash
# 登录哨兵（NodePort: 30300）
redis-cli -h bitnami-redis.bitnami-redis.svc.cluster.local -p 30350 -a $REDIS_PASSWORD
# 列出所有监听的主节点
sentinel masters
# 列出特定主节点的从节点
sentinel slaves mymaster
# 登录具体节点（addr、port替换为sentinel masters结果中的值）
redis-cli -h addr -p port -a $REDIS_PASSWORD
# redis-cli -h bitnami-redis-node-0.bitnami-redis -p 30301 -a $REDIS_PASSWORD

# 外部连接
NODE_IP=$(kubectl -n bitnami-redis get nodes -o jsonpath="{.items[0].status.addresses[0].address}")
NODE_PORT=$(kubectl -n bitnami-redis get services bitnami-redis -o jsonpath="{.spec.ports[1].nodePort}")
redis-cli -h $NODE_IP -p $NODE_PORT -a $REDIS_PASSWORD
